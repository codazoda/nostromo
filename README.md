# K8s From Scratch

- Introduction
    - K8s From Scratch
        - We'll create three services
        - We'll dockerize those services
        - We'll launch those in K8s
    - About
        - I accidentally created this presentation
        - I was struggling with Kubernetes
        - I wanted to setup my tools at home
        - I've got Mac, Mini, Pi Zero, Pi 400
            - Couldn't decide
            - Needed to containerize
        - I do a form of "readme driven development"
        - I wanted to simplify down to the very basics
        - It's simple, not easy
            - This still ends up being relatively complex
        - It let me procrastinate on building my own cluster
    - Prerequisites
        - Docker Desktop
        - Enable K8s in Docker Desktop Settings
- Create the nostromo directory, this is our cluster (deployment)
- Create keypad, our first app
    - This is a PHP app
    - Create the index.php file
    - Run with the dev server
    - Test on port 9801
- Create clock, our second app
    - This is a go app
    - Create the clock.go file
    - Compile the clock.go file
    - Run clock
    - Test on port 9802
- Compile for Linux
    - I know I'll run these on linux and go is compiled
    - Default binaries are for my dev OS
    - Go can cross compile
    - GOOS=linux GOARCH=amd64 go build -o files/clock clock.go
- Create refinery
    - Also GoLang
    - Create the refinery.go file
    - Compile refinery.go
    - Run locally
    - Test on port 9800
    - Cross compile
- Create the keypad Dockerfile
    - We'll use alpine
        - I hear that's what Nathan does
        - It's small
        - There's also a base image on GKE
        - Maybe that's what Nathan really does
    - Build the docker image for keypad
        - Show it in docker desktop
        - Size is ~19MB
            - Don't use built-in in production
    - Build the docker container for keypad
        - Show it in docker desktop
        - Test it in the browser
- Create Dockerfile, image, and container for clock
- Create the Dockerfile, image, and container for refinery
- Push the images to docker hub
    - docker tag refinery deseretdigital/sms_refinery:latest
        - Don't use dashes
        - For bigger org you need a naming strategy
    - docker login (might be required)
    - docker push docker push deseretdigital/sms_refinery:latest
    - Look in docker hub
- Build keypad K8s
    - Create the keypad.yaml file
    - Apply the deployment
        - kubectl apply -f keypad.yaml
    - Review in docker desktop
    - Adjust replicas to 10
    - Adjust replicas to 1
- Build clock K8s
    - Create the clock.yaml file
    - Apply the deployment
        - kubectl apply -f clock.yaml
    - Review in docker desktop
- Build refinery K8s
    - Create the refinery.yaml file
    - Apply the deployment
        - kubectl apply -f refinery.yaml
    - Review in docker desktop
- Build combined K8s
    - Most services are stand-alone
    - For very tightly coupled things
    - Create the nostromo.yaml file
    - Apply the deployment
        - kubectl apply -f nostromo.yaml
    - Review in docker desktop
    - Adjust replicas to 3
    - Adjust replicas to 1
